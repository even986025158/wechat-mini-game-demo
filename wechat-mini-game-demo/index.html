<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¥¥è’é£æ ¼ç”Ÿå­˜æ¸¸æˆ Demo</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            font-family: Arial, sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        
        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            border: 2px solid #444;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        
        #game-canvas {
            display: block;
            background: #2d2d2d;
        }
        
        #ui-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 14px;
            pointer-events: none;
        }
        
        #controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            font-size: 12px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
        }
        
        .stat-bar {
            margin: 5px 0;
            padding: 5px 10px;
            background: rgba(0,0,0,0.5);
            border-radius: 3px;
        }
        
        .hunger-bar { color: #ff6b35; }
        .health-bar { color: #4CAF50; }
        .sanity-bar { color: #9C27B0; }
        
        .time-display {
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        
        #start-screen h1 {
            color: #ff9900;
            font-size: 32px;
            margin-bottom: 20px;
        }
        
        #start-btn {
            padding: 15px 30px;
            background: #ff9900;
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        #start-btn:hover {
            transform: scale(1.1);
        }
        
        #resource-display {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            color: white;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas" width="800" height="600"></canvas>
        
        <div id="ui-overlay">
            <div class="stat-bar hunger-bar">é¥¥é¥¿: <span id="hunger-value">100</span></div>
            <div class="stat-bar health-bar">ç”Ÿå‘½: <span id="health-value">100</span></div>
            <div class="stat-bar sanity-bar">ç²¾ç¥: <span id="sanity-value">100</span></div>
            
            <div class="time-display">
                <div>å¤©æ•°: <span id="day-count">1</span></div>
                <div>æ—¶é—´: <span id="time-of-day">ç™½å¤©</span></div>
                <div>å¤©æ°”: <span id="weather">æ™´å¤©</span></div>
            </div>
        </div>
        
        <div id="resource-display">
            <div>æœ¨æ: <span id="wood-count">0</span></div>
            <div>çŸ³å¤´: <span id="stone-count">0</span></div>
            <div>é£Ÿç‰©: <span id="food-count">0</span></div>
        </div>
        
        <div id="controls">
            <div><strong>æ§åˆ¶è¯´æ˜:</strong></div>
            <div>WASD - ç§»åŠ¨è§’è‰²</div>
            <div>ç©ºæ ¼ - é‡‡é›†èµ„æº</div>
            <div>E - å»ºé€ ç¯ç«</div>
            <div>R - å»ºé€ å·¥ä½œå°</div>
            <div>F - è¿›é£Ÿ</div>
        </div>
        
        <div id="start-screen">
            <h1>ğŸŒ² ç”Ÿå­˜å†’é™© ğŸŒ²</h1>
            <p style="color: #ccc; margin-bottom: 30px;">æ”¶é›†èµ„æº â€¢ å»ºé€ å®¶å›­ â€¢ ç”Ÿå­˜ä¸‹å»</p>
            <button id="start-btn">å¼€å§‹æ¸¸æˆ</button>
        </div>
    </div>

    <script>
        // å®Œæ•´çš„æ¸¸æˆé€»è¾‘
        class SurvivalGame {
            constructor() {
                this.canvas = document.getElementById('game-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.gameState = 'menu';
                
                this.player = {
                    x: 400,
                    y: 300,
                    width: 30,
                    height: 50,
                    hunger: 100,
                    health: 100,
                    sanity: 100,
                    speed: 4,
                    inventory: { wood: 0, stone: 0, food: 0 }
                };
                
                this.world = {
                    dayCount: 1,
                    timeOfDay: 'day',
                    trees: [],
                    stones: [],
                    campfires: [],
                    workbenches: []
                };
                
                this.keys = {};
                this.lastUpdateTime = 0;
                this.dayNightCycle = 0;
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.generateWorld();
                this.gameLoop();
            }
            
            setupEventListeners() {
                // é”®ç›˜æ§åˆ¶
                document.addEventListener('keydown', (e) => {
                    this.keys[e.key.toLowerCase()] = true;
                });
                
                document.addEventListener('keyup', (e) => {
                    this.keys[e.key.toLowerCase()] = false;
                });
                
                // å¼€å§‹æ¸¸æˆæŒ‰é’®
                document.getElementById('start-btn').addEventListener('click', () => {
                    this.startGame();
                });
            }
            
            startGame() {
                this.gameState = 'playing';
                document.getElementById('start-screen').style.display = 'none';
                this.lastUpdateTime = performance.now();
            }
            
            generateWorld() {
                // ç”Ÿæˆæ ‘æœ¨
                for (let i = 0; i < 20; i++) {
                    this.world.trees.push({
                        x: Math.random() * 700 + 50,
                        y: Math.random() * 500 + 50,
                        type: 'tree',
                        size: 40
                    });
                }
                
                // ç”ŸæˆçŸ³å¤´
                for (let i = 0; i < 15; i++) {
                    this.world.stones.push({
                        x: Math.random() * 700 + 50,
                        y: Math.random() * 500 + 50,
                        type: 'stone',
                        size: 30
                    });
                }
            }
            
            update(timestamp) {
                if (this.gameState !== 'playing') return;
                
                const deltaTime = (timestamp - this.lastUpdateTime) / 1000;
                this.lastUpdateTime = timestamp;
                
                // ç§»åŠ¨æ§åˆ¶
                if (this.keys['w'] || this.keys['arrowup']) this.player.y -= this.player.speed;
                if (this.keys['s'] || this.keys['arrowdown']) this.player.y += this.player.speed;
                if (this.keys['a'] || this.keys['arrowleft']) this.player.x -= this.player.speed;
                if (this.keys['d'] || this.keys['arrowright']) this.player.x += this.player.speed;
                
                // è¾¹ç•Œæ£€æŸ¥
                this.player.x = Math.max(0, Math.min(770, this.player.x));
                this.player.y = Math.max(0, Math.min(550, this.player.y));
                
                // çŠ¶æ€æ›´æ–°
                this.player.hunger = Math.max(0, this.player.hunger - deltaTime * 2);
                if (this.player.hunger < 30) {
                    this.player.health = Math.max(0, this.player.health - deltaTime * 1);
                }
                
                // æ˜¼å¤œå¾ªç¯
                this.dayNightCycle += deltaTime;
                if (this.dayNightCycle > 60) { // 60ç§’ä¸€ä¸ªå‘¨æœŸ
                    this.dayNightCycle = 0;
                    this.world.timeOfDay = this.world.timeOfDay === 'day' ? 'night' : 'day';
                    if (this.world.timeOfDay === 'day') {
                        this.world.dayCount++;
                    }
                }
                
                // è¡ŒåŠ¨æ§åˆ¶
                if (this.keys[' ']) { // ç©ºæ ¼é”®é‡‡é›†
                    this.collectResources();
                    this.keys[' '] = false; // é˜²æ­¢è¿ç»­è§¦å‘
                }
                
                if (this.keys['f']) { // Fé”®è¿›é£Ÿ
                    this.eatFood();
                    this.keys['f'] = false;
                }
                
                if (this.keys['e']) { // Eé”®å»ºé€ ç¯ç«
                    this.buildCampfire();
                    this.keys['e'] = false;
                }
                
                if (this.keys['r']) { // Ré”®å»ºé€ å·¥ä½œå°
                    this.buildWorkbench();
                    this.keys['r'] = false;
                }
                
                this.updateUI();
            }
            
            collectResources() {
                const collectDistance = 60;
                
                // é‡‡é›†æ ‘æœ¨
                const nearbyTree = this.world.trees.find(tree => {
                    const dx = tree.x - this.player.x;
                    const dy = tree.y - this.player.y;
                    return Math.sqrt(dx*dx + dy*dy) < collectDistance;
                });
                
                if (nearbyTree) {
                    this.world.trees = this.world.trees.filter(tree => tree !== nearbyTree);
                    this.player.inventory.wood += 2;
                    // ç æ ‘æ—¶æœ‰å‡ ç‡è·å¾—é£Ÿç‰©ï¼ˆæµ†æœï¼‰
                    if (Math.random() < 0.3) {
                        this.player.inventory.food += 1;
                        this.showMessage('è·å¾—æœ¨æå’Œæµ†æœï¼');
                    } else {
                        this.showMessage('è·å¾—æœ¨æï¼');
                    }
                    return;
                }
                
                // é‡‡é›†çŸ³å¤´
                const nearbyStone = this.world.stones.find(stone => {
                    const dx = stone.x - this.player.x;
                    const dy = stone.y - this.player.y;
                    return Math.sqrt(dx*dx + dy*dy) < collectDistance;
                });
                
                if (nearbyStone) {
                    this.world.stones = this.world.stones.filter(stone => stone !== nearbyStone);
                    this.player.inventory.stone += 1;
                    this.showMessage('è·å¾—çŸ³å¤´ï¼');
                }
                
                // é‡‡é›†æµ†æœä¸›ï¼ˆæ–°å¢é£Ÿç‰©æ¥æºï¼‰
                const nearbyBerry = this.world.berries.find(berry => {
                    const dx = berry.x - this.player.x;
                    const dy = berry.y - this.player.y;
                    return Math.sqrt(dx*dx + dy*dy) < collectDistance;
                });
                
                if (nearbyBerry) {
                    this.world.berries = this.world.berries.filter(berry => berry !== nearbyBerry);
                    this.player.inventory.food += 2;
                    this.showMessage('è·å¾—æµ†æœï¼');
                }
            }
            
            eatFood() {
                if (this.player.inventory.food > 0) {
                    this.player.inventory.food--;
                    this.player.hunger = Math.min(100, this.player.hunger + 30);
                    this.player.health = Math.min(100, this.player.health + 10);
                    this.showMessage('è¿›é£Ÿæ¢å¤ï¼');
                } else {
                    this.showMessage('æ²¡æœ‰é£Ÿç‰©ï¼');
                }
            }
            
            buildCampfire() {
                if (this.player.inventory.wood >= 3 && this.player.inventory.stone >= 2) {
                    this.player.inventory.wood -= 3;
                    this.player.inventory.stone -= 2;
                    
                    this.world.campfires.push({
                        x: this.player.x,
                        y: this.player.y,
                        lightRadius: 100
                    });
                    
                    this.showMessage('å»ºé€ äº†ç¯ç«ï¼');
                } else {
                    this.showMessage('éœ€è¦3æœ¨æå’Œ2çŸ³å¤´ï¼');
                }
            }
            
            buildWorkbench() {
                if (this.player.inventory.wood >= 5) {
                    this.player.inventory.wood -= 5;
                    
                    this.world.workbenches.push({
                        x: this.player.x,
                        y: this.player.y
                    });
                    
                    this.showMessage('å»ºé€ äº†å·¥ä½œå°ï¼');
                } else {
                    this.showMessage('éœ€è¦5æœ¨æï¼');
                }
            }
            
            showMessage(text) {
                // ç®€å•çš„æ¶ˆæ¯æ˜¾ç¤ºï¼ˆå¯ä»¥æ‰©å±•ä¸ºæ›´å¤æ‚çš„UIï¼‰
                console.log('æ¸¸æˆæ¶ˆæ¯:', text);
            }
            
            updateUI() {
                document.getElementById('hunger-value').textContent = Math.round(this.player.hunger);
                document.getElementById('health-value').textContent = Math.round(this.player.health);
                document.getElementById('sanity-value').textContent = Math.round(this.player.sanity);
                document.getElementById('day-count').textContent = this.world.dayCount;
                document.getElementById('time-of-day').textContent = this.world.timeOfDay === 'day' ? 'ç™½å¤©' : 'å¤œæ™š';
                document.getElementById('wood-count').textContent = this.player.inventory.wood;
                document.getElementById('stone-count').textContent = this.player.inventory.stone;
                document.getElementById('food-count').textContent = this.player.inventory.food;
                
                // æ ¹æ®æ—¶é—´è°ƒæ•´å¤©æ°”æ˜¾ç¤º
                document.getElementById('weather').textContent = 
                    this.world.timeOfDay === 'night' ? 'æ˜Ÿç©º' : 'æ™´å¤©';
            }
            
            render() {
                // æ¸…ç©ºç”»å¸ƒ
                if (this.world.timeOfDay === 'day') {
                    this.ctx.fillStyle = '#87CEEB'; // å¤©è“è‰²ç™½å¤©èƒŒæ™¯
                } else {
                    this.ctx.fillStyle = '#191970'; // æ·±è“è‰²å¤œæ™šèƒŒæ™¯
                }
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ç»˜åˆ¶è‰åœ°
                this.ctx.fillStyle = this.world.timeOfDay === 'day' ? '#7CFC00' : '#006400';
                this.ctx.fillRect(0, 400, this.canvas.width, 200);
                
                // ç»˜åˆ¶æ ‘æœ¨
                this.world.trees.forEach(tree => {
                    this.ctx.fillStyle = '#228B22'; // ç»¿è‰²æ ‘å¹²
                    this.ctx.fillRect(tree.x - 10, tree.y - 30, 20, 40);
                    this.ctx.fillStyle = '#32CD32'; // æµ…ç»¿è‰²æ ‘å† 
                    this.ctx.beginPath();
                    this.ctx.arc(tree.x, tree.y - 40, 25, 0, Math.PI * 2);
                    this.ctx.fill();
                });
                
                // ç»˜åˆ¶çŸ³å¤´
                this.world.stones.forEach(stone => {
                    this.ctx.fillStyle = '#696969'; // ç°è‰²çŸ³å¤´
                    this.ctx.beginPath();
                    this.ctx.arc(stone.x, stone.y, 15, 0, Math.PI * 2);
                    this.ctx.fill();
                });
                
                // ç»˜åˆ¶ç¯ç«
                this.world.campfires.forEach(fire => {
                    // ç«å…‰æ•ˆæœ
                    this.ctx.fillStyle = 'rgba(255, 100, 0, 0.3)';
                    this.ctx.beginPath();
                    this.ctx.arc(fire.x, fire.y, fire.lightRadius, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    // ç¯ç«æœ¬ä½“
                    this.ctx.fillStyle = '#FF4500';
                    this.ctx.fillRect(fire.x - 8, fire.y - 8, 16, 16);
                });
                
                // ç»˜åˆ¶å·¥ä½œå°
                this.world.workbenches.forEach(bench => {
                    this.ctx.fillStyle = '#8B4513'; // æ£•è‰²å·¥ä½œå°
                    this.ctx.fillRect(bench.x - 15, bench.y - 10, 30, 20);
                });
                
                // ç»˜åˆ¶ç©å®¶
                this.ctx.fillStyle = '#FF6B6B'; // ç²‰è‰²ç©å®¶èº«ä½“
                this.ctx.fillRect(this.player.x - 15, this.player.y - 25, 30, 50);
                
                // ç©å®¶å¤´éƒ¨
                this.ctx.fillStyle = '#FFB6C1'; // æµ…ç²‰è‰²å¤´éƒ¨
                this.ctx.beginPath();
                this.ctx.arc(this.player.x, this.player.y - 35, 12, 0, Math.PI * 2);
                this.ctx.fill();
                
                // ç©å®¶çŠ¶æ€æ¡
                this.renderPlayerBars();
            }
            
            renderPlayerBars() {
                const barWidth = 60;
                const barHeight = 6;
                const startX = this.player.x - 30;
                const startY = this.player.y - 50;
                
                // é¥¥é¥¿æ¡
                this.ctx.fillStyle = '#FFA500';
                this.ctx.fillRect(startX, startY, barWidth * (this.player.hunger / 100), barHeight);
                this.ctx.strokeStyle = '#000';
                this.ctx.strokeRect(startX, startY, barWidth, barHeight);
                
                // ç”Ÿå‘½æ¡
                this.ctx.fillStyle = '#FF0000';
                this.ctx.fillRect(startX, startY + 10, barWidth * (this.player.health / 100), barHeight);
                this.ctx.strokeRect(startX, startY + 10, barWidth, barHeight);
                
                // ç²¾ç¥æ¡
                this.ctx.fillStyle = '#9370DB';
                this.ctx.fillRect(startX, startY + 20, barWidth * (this.player.sanity / 100), barHeight);
                this.ctx.strokeRect(startX, startY + 20, barWidth, barHeight);
            }
            
            gameLoop(timestamp) {
                this.update(timestamp);
                this.render();
                requestAnimationFrame((t) => this.gameLoop(t));
            }
        }
        
        // å¯åŠ¨æ¸¸æˆ
        window.addEventListener('load', () => {
            new SurvivalGame();
        });
    </script>
</body>
</html>